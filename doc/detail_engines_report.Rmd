---
title: "In Detail: Report Engines"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{In Detail: Report Engines}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

Report Engines in `flowengineR` are used to **assemble multiple reportelements into structured reports**. They serve as an intermediate layer between modular content (reportelements) and final output formats (publishing). The result is a cohesive document composed of logically grouped visualizations, tables, and textual summaries.

Reports can be used standalone for internal reporting, or passed into a Publishing Engine to be exported as HTML, PDF, or JSON.

---

## üì• Standardized Inputs (via Wrapper)
These inputs are passed automatically from the framework:

| Input             | Type         | Description                                                                 |
|------------------|--------------|-----------------------------------------------------------------------------|
| `reportelements` | list         | Named list of precomputed reportelement outputs (‚ö†Ô∏è provided by the framework) |
| `params`         | list         | Report-specific parameters for selecting and grouping reportelements       |
| `alias_report`   | character    | Unique identifier for the current report (used for logging and naming)     |

Framework resolution:
- `reportelements`: provided by the framework, generated from previous reporting step
- `params`: from `control$params$report$params[[alias_report]]`
- `alias_report`: from `control$engine_select$report`

---

## üì§ Standardized Output (via Wrapper)
Returned via `initialize_output_report()`:

| Output              | Type         | Description                                               |
|---------------------|--------------|-----------------------------------------------------------|
| `report_title`      | character    | Title of the report                                       |
| `report_type`       | character    | Type or identifier for the report engine                  |
| `compatible_formats`| character    | Vector of allowed publishing formats                      |
| `sections`          | list         | Structured content: list of sections with heading/content |
| `params`            | list         | Parameters used                                           |
| `specific_output`   | list / NULL  | Optional additional information                           |

---

## üîó Relationship to Other Layers

- **Reportelement Engines** produce modular visual/text/table outputs
- **Report Engines** group and structure these for interpretation
- **Publishing Engines** convert structured reports to external formats

Without at least one `reportelement`, no report can be constructed. Publishing likewise requires a completed report or reportelement.

---

## ‚öôÔ∏è Available Report Engines

| Engine Name          | Function Name                    | Description                            | Template Path                                                   | Detail Page |
|----------------------|----------------------------------|----------------------------------------|------------------------------------------------------------------|-------------|
| `report_modelsummary`| `engine_report_modelsummary()`   | Structured summary report with MSE, visuals, and metrics | `inst/templates_control/9_a_template_report_modelsummary.R` | [üìÑ](detail_engine_report_modelsummary.html) |

Use `list_registered_engines("report")` to view available report engines.

---

## üß© Engine Usage in Workflow

```r
control$engine_select$report <- list(
  main_report = "report_modelsummary"
)

control$params$report <- controller_report(
  params = list(
    main_report = list(
      mse_text = "text_mse_summary",
      gender_box = "gender_box_adjusted",
      age_box = "age_box",
      metrics_table = "metrics_table"
    )
  )
)
```

---

## üõ†Ô∏è Writing Your Own Report Engine

To implement a report engine:

1. Create an `engine_*()` that accepts a list of reportelements and arranges them into sections.
2. Register a corresponding `wrapper_*()` that injects aliases and parameters.
3. Use `initialize_output_report()` to return the final output.

---

## üéØ Possible Use-Case: Standardized Model Summary

The `report_modelsummary` engine is useful for generating a reproducible overview of a trained model's quality and fairness.

Future report engines may target specific stakeholder groups. For instance, a **corporate internal summary report** could include:

- Company logo and branding
- Introduction and interpretation texts
- Structured layout for board-level reporting

This would allow users to create fully styled reports directly from R, using predefined templates tailored to internal workflows.

 It typically includes:

- One or more key metrics (e.g., MSE text)
- One or more visualizations (e.g., boxplots by group)
- Tabular overviews of split-level performance/fairness

This structure is ideal for internal QA, documentation, or comparative benchmarking.
