<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="mwiller" />


<title>In Detail: Engines - Inprocessing</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">In Detail: Engines - Inprocessing</h1>
<h3 class="subtitle">Fairness-aware methods applied during model
training</h3>
<h4 class="author">mwiller</h4>


<div id="TOC">
<ul>
<li><a href="#standardized-inputs-via-wrapper" id="toc-standardized-inputs-via-wrapper">üì• Standardized Inputs (via
Wrapper)</a></li>
<li><a href="#standardized-output-via-wrapper" id="toc-standardized-output-via-wrapper">üì§ Standardized Output (via
Wrapper)</a></li>
<li><a href="#available-inprocessing-engines" id="toc-available-inprocessing-engines">‚öôÔ∏è Available Inprocessing
Engines</a></li>
<li><a href="#engine-usage-in-workflow" id="toc-engine-usage-in-workflow">üß© Engine Usage in Workflow</a></li>
<li><a href="#compatibility-considerations" id="toc-compatibility-considerations">üîÑ Compatibility
Considerations</a></li>
<li><a href="#writing-your-own-inprocessing-engine" id="toc-writing-your-own-inprocessing-engine">üõ†Ô∏è Writing Your Own
Inprocessing Engine</a></li>
<li><a href="#possible-use-case-fairness-aware-inprocessing" id="toc-possible-use-case-fairness-aware-inprocessing">üéØ Possible
Use-Case: Fairness-Aware Inprocessing</a></li>
</ul>
</div>

<blockquote>
<p><strong>Summary</strong><br />
This vignette introduces the <strong>inprocessing
engines</strong>.<br />
It explains how fairness interventions can be embedded directly into the
training process of models, integrating fairness-aware methods while
keeping compatibility with the flowengineR control structure.</p>
</blockquote>
<hr />
<p>Inprocessing Engines in <code>flowengineR</code> are used to modify
or extend the behavior of the training process. They operate directly on
the model or training logic and can implement various techniques such as
custom optimization strategies, model adjustments, or fairness-related
modifications.</p>
<hr />
<div id="standardized-inputs-via-wrapper" class="section level2">
<h2>üì• Standardized Inputs (via Wrapper)</h2>
<p>These inputs are passed to the engine wrapper and are provided
directly by the workflow:</p>
<table>
<colgroup>
<col width="24%" />
<col width="14%" />
<col width="60%" />
</colgroup>
<thead>
<tr class="header">
<th>Input</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>driver_train</code></td>
<td>list</td>
<td>Output from the main training engine (‚ö†Ô∏è provided by the framework
from train output)</td>
</tr>
<tr class="even">
<td><code>data</code></td>
<td>data.frame</td>
<td>Original training data (‚ö†Ô∏è provided by the framework)</td>
</tr>
<tr class="odd">
<td><code>protected_attribute_names</code></td>
<td>character vector</td>
<td>Protected group variables (e.g., ‚Äúgender‚Äù, ‚Äúrace‚Äù) (‚ö†Ô∏è provided by
the framework)</td>
</tr>
<tr class="even">
<td><code>params</code></td>
<td>list</td>
<td>Additional parameters for fairness inprocessing</td>
</tr>
<tr class="odd">
<td><code>control_for_training</code></td>
<td>list</td>
<td>Training-specific control settings (e.g., hyperparams, model type)
(‚ö†Ô∏è provided by the framework)</td>
</tr>
</tbody>
</table>
<p>Framework resolution:</p>
<ul>
<li><code>driver_train</code>: provided by the workflow (output from
training engine)</li>
<li><code>data</code>: provided by the workflow (preprocessed or raw
training dataset)</li>
<li><code>protected_attribute_names</code>: resolved via
<code>control$data$vars$protected</code></li>
<li><code>params</code>: passed via
<code>control$params$inprocessing$params</code></li>
<li><code>control_for_training</code>: provided by the workflow
(includes training-related configuration)</li>
</ul>
<hr />
</div>
<div id="standardized-output-via-wrapper" class="section level2">
<h2>üì§ Standardized Output (via Wrapper)</h2>
<p>Returned via <code>initialize_output_fairness_in()</code>:</p>
<table>
<colgroup>
<col width="20%" />
<col width="14%" />
<col width="64%" />
</colgroup>
<thead>
<tr class="header">
<th>Output</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>adjusted_model</code></td>
<td>model object</td>
<td>Modified model object after fairness-aware adjustment</td>
</tr>
<tr class="even">
<td><code>model_type</code></td>
<td>character</td>
<td>Identifier of the adjusted model type</td>
</tr>
<tr class="odd">
<td><code>predictions</code></td>
<td>vector</td>
<td>Optional: Predictions or adjusted outputs</td>
</tr>
<tr class="even">
<td><code>params</code></td>
<td>list</td>
<td>Parameters used</td>
</tr>
<tr class="odd">
<td><code>specific_output</code></td>
<td>list / NULL</td>
<td>Engine-specific metadata</td>
</tr>
</tbody>
</table>
<hr />
</div>
<div id="available-inprocessing-engines" class="section level2">
<h2>‚öôÔ∏è Available Inprocessing Engines</h2>
<table>
<colgroup>
<col width="16%" />
<col width="22%" />
<col width="17%" />
<col width="37%" />
<col width="6%" />
</colgroup>
<thead>
<tr class="header">
<th>Engine Name</th>
<th>Function Name</th>
<th>Description</th>
<th>Template Path</th>
<th>Detail Page</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>inprocessing_fairness_adversialdebiasing</code></td>
<td><code>engine_inprocessing_fairness_adversialdebiasing()</code></td>
<td>Adversarial debiasing during training</td>
<td><code>inst/templates_control/5_a_template_control_inprocessing_fairness_adversialdebiasing.R</code></td>
<td><a href="detail_inprocessing_fairness_adversialdebiasing.html">üìÑ</a></td>
</tr>
</tbody>
</table>
<p>Use <code>list_registered_engines(&quot;inprocessing&quot;)</code> to inspect
all currently loaded inprocessing engines.</p>
<hr />
</div>
<div id="engine-usage-in-workflow" class="section level2">
<h2>üß© Engine Usage in Workflow</h2>
<p>To activate an inprocessing engine:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>control<span class="sc">$</span>engine_select<span class="sc">$</span>inprocessing <span class="ot">&lt;-</span> <span class="st">&quot;inprocessing_fairness_adversialdebiasing&quot;</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>control<span class="sc">$</span>params<span class="sc">$</span>inprocessing <span class="ot">&lt;-</span> <span class="fu">controller_inprocessing</span>(</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>  <span class="at">params =</span> <span class="fu">list</span>(<span class="at">adversary_epochs =</span> <span class="dv">10</span>, <span class="at">lambda =</span> <span class="fl">1.0</span>)</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>)</span></code></pre></div>
<p>The engine is called <em>after</em> the main model is trained and can
access both raw data and model output.</p>
<hr />
</div>
<div id="compatibility-considerations" class="section level2">
<h2>üîÑ Compatibility Considerations</h2>
<p>Due to the complexity of inprocessing logic, not every inprocessing
engine is compatible with all training engines. For example, some
inprocessing methods may require access to internal model structures or
specific training behaviors that are only available for certain model
types (e.g., neural networks or ensemble methods).</p>
<p>Compatibility must therefore be checked individually for each engine
combination. It is recommended to consult the engine documentation or
implementation before combining inprocessing with custom training
engines.</p>
<hr />
</div>
<div id="writing-your-own-inprocessing-engine" class="section level2">
<h2>üõ†Ô∏è Writing Your Own Inprocessing Engine</h2>
<p>To implement a custom inprocessing engine:</p>
<ol style="list-style-type: decimal">
<li>Write an <code>engine_*()</code> function that adjusts a model based
on fairness criteria.</li>
<li>Create a wrapper that receives all required inputs and produces a
standardized output.</li>
<li>Return your result via
<code>initialize_output_inprocessing()</code>.</li>
</ol>
<p>For examples, see:</p>
<ul>
<li><code>wrapper_inprocessing_fairness_adversialdebiasing()</code></li>
</ul>
<hr />
</div>
<div id="possible-use-case-fairness-aware-inprocessing" class="section level2">
<h2>üéØ Possible Use-Case: Fairness-Aware Inprocessing</h2>
<p>Inprocessing is ideal when model training must be adapted to meet
fairness constraints directly. A prominent example is
<strong>adversarial debiasing</strong>, where a secondary model (the
adversary) learns to predict group membership from intermediate
representations of the main model. The training then minimizes the
adversary‚Äôs success while retaining predictive accuracy.</p>
<p>This technique can be applied to neural networks and other flexible
learners, enforcing fairness without compromising overall model
structure.</p>
<p>Example:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>control<span class="sc">$</span>engine_select<span class="sc">$</span>inprocessing <span class="ot">&lt;-</span> <span class="st">&quot;inprocessing_fairness_adversialdebiasing&quot;</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>control<span class="sc">$</span>params<span class="sc">$</span>inprocessing <span class="ot">&lt;-</span> <span class="fu">controller_inprocessing</span>(</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>  <span class="at">params =</span> <span class="fu">list</span>(<span class="at">adversary_epochs =</span> <span class="dv">10</span>, <span class="at">lambda =</span> <span class="fl">1.0</span>)</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>)</span></code></pre></div>
<p>This method integrates fairness into the optimization loop and is
especially useful when working with complex model representations or
high-capacity learners.</p>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
